# План проекта: Фронтенд KPI Cascading Agent

## Контекст

**Бэкенд:** LangGraph, Ollama, Open Web UI  
**Фронтенд:** React  
**Назначение:** инструмент каскадирования KPI от целей руководства к подразделениям банка с использованием LLM и загружаемых документов.

---

## 1. Архитектура приложения

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        React SPA (Frontend)                              │
├──────────────┬──────────────┬──────────────┬────────────────────────────┤
│  Импорт      │  Чат с LLM   │  Дашборды    │  Навигация / Общее          │
│  документов  │  + вложения  │  и графики   │  (layout, auth, API)        │
└──────────────┴──────────────┴──────────────┴────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│  API (Open Web UI / LangGraph)  →  Ollama (модели)                       │
└─────────────────────────────────────────────────────────────────────────┘
```

- **Одна SPA** с роутингом по страницам.
- Общий **layout**: шапка, сайдбар или табы для переключения между разделами.
- Все запросы к LLM и загрузка файлов идут через **единый API-слой** (адаптер к Open Web UI / вашему LangGraph API).

---

## 2. Страницы и структура UI

### 2.1 Страница 1: Импорт документов банка

**Цель:** загрузить и хранить документы, которые потом используются как **attachment** к промпту в LLM.

**UI:**

- **Зона загрузки (drag-and-drop + кнопка «Выбрать файлы»):**
  - Форматы: PDF, DOCX, XLSX, TXT (по согласованию с бэкендом).
  - Множественная загрузка.
  - Отображение очереди: имя файла, размер, статус (загрузка / готов / ошибка).

- **Список загруженных документов (таблица или карточки):**
  - Название, дата загрузки, размер, тип.
  - Действия: скачать, удалить, «использовать в чате» (добавить в контекст/вложения текущего чата при переходе на страницу 2).

- **Опционально:** категории/теги документов (регламенты, стратегия, планы), чтобы при чате выбирать готовые наборы вложений.

**Технически:**  
Файлы отправляются на бэкенд (Open Web UI или ваш endpoint), сохраняются и возвращается идентификатор. При отправке промпта в LLM передаются id выбранных документов как attachment.

---

### 2.2 Страница 2: Чат с LLM и вложения

**Цель:** общение с моделью с возможностью прикреплять файлы (в т.ч. бизнес-план, цели подразделений, чеклисты).

**UI:**

- **Левая колонка (или сайдбар):**
  - Список чатов (история диалогов).
  - Кнопка «Новый чат».

- **Центральная область — окно чата:**
  - История сообщений: пользователь / ассистент, markdown, при необходимости превью прикреплённых файлов.
  - Поле ввода внизу + кнопка отправки.

- **Блок вложений к промпту (над полем ввода или рядом):**
  - **Выбор уже загруженных документов** (со страницы импорта): чекбоксы или мультиселект списка.
  - **Загрузка «на лету»:** ещё одна зона drag-and-drop или кнопка «Прикрепить файл» для:
    - файла с целями руководителя (бизнес-план / цели);
    - файлов с целями подразделений;
    - двух чеклистов: по стратегии и по регламенту банка.
  - Визуальное отображение прикреплённых файлов: иконка, имя, крестик для снятия.

- **Правый боковой панель (опционально):**
  - Превью выбранного документа или краткое описание «что прикреплено к этому чату».

**Логика:**  
Один «чат» = один сценарий каскадирования. К нему привязываются: выбранные документы банка (из импорта) + при необходимости загруженные в чат файлы (план, цели, чеклисты). Всё уходит в API как контекст/attachments к запросу к LLM (LangGraph/Open Web UI).

---

### 2.3 Страница 3: Дашборды и графики по каскадируемым целям

**Цель:** визуализация целей и их каскадирования «руководитель → директора подразделений» на основе загруженного файла целей и результатов работы LLM.

**UI:**

- **Верхний блок — фильтры/период:**
  - Выбор периода (год/квартал).
  - Выбор уровня: общие цели / по подразделениям.
  - Опционально: выбор конкретного подразделения.

- **Основная область — дашборд:**
  - **Иерархия целей (дерево или sunburst):** корень = цели руководителя, ветви = цели по подразделениям (из файла целей + при желании из ответов LLM).
  - **Графики:**
    - Достижение KPI по целям (прогресс, %): bar chart или gauge.
    - Сравнение подразделений: столбчатые/линейные графики.
    - Воронка или матрица «цель — подразделение — статус».
  - **Таблица целей:** цели, ответственный, подразделение, срок, статус, прогресс — с сортировкой и фильтрацией.

- **Источник данных:**  
  Данные для дашборда могут приходить: (1) из разбора загруженного файла целей на бэкенде, (2) из структурированного ответа LLM (LangGraph) после сценария каскадирования. API должен возвращать JSON с иерархией целей и метриками.

**Библиотеки для графиков:** Recharts, Chart.js или ApexCharts — на выбор под дизайн.

---

## 3. Общая навигация и UX

- **Навигация:** верхнее меню или боковой сайдбар с пунктами:
  - «Импорт документов»
  - «Чат с моделью» (или «Каскадирование»)
  - «Дашборды»
- **Единый стиль:** одна цветовая схема, общие компоненты (кнопки, карточки, таблицы, поля ввода).
- **Состояния загрузки:** спиннеры/скелетоны при запросах к API и загрузке файлов.
- **Ошибки:** тосты или inline-сообщения при ошибках API/загрузки.

---

## 4. Рекомендуемый стек фронтенда

| Назначение              | Вариант                          |
|-------------------------|----------------------------------|
| Фреймворк               | React 18+                        |
| Язык                    | TypeScript                       |
| Роутинг                 | React Router v6                  |
| Сборка                  | Vite                             |
| UI-библиотека           | Material UI (MUI) или Ant Design |
| Графики                 | Recharts                         |
| Запросы к API           | TanStack Query (React Query)     |
| Формы/валидация         | React Hook Form + Zod            |
| Загрузка файлов         | drag-and-drop (react-dropzone)   |
| Состояние (при необходимости) | Zustand или Context          |

---

## 5. Этапы разработки (кратко)

1. **Каркас:** Vite + React + TypeScript, роутинг, layout, навигация между тремя страницами.
2. **Страница импорта:** форма загрузки, список документов, интеграция с API сохранения файлов.
3. **Страница чата:** список чатов, окно сообщений, поле ввода, блок вложений (выбор из загруженных + загрузка новых), интеграция с Open Web UI / LangGraph API.
4. **Страница дашбордов:** разметка, фильтры, подключение API целей/KPI, графики и таблица.
5. **Полировка:** обработка ошибок, загрузки, адаптив, тесты (по необходимости).

---

## 6. Интеграция с бэкендом

- **Open Web UI:** использовать существующие API чата и загрузки файлов; при необходимости — кастомный endpoint для «каскадирования» (LangGraph).
- **LangGraph:** если сценарий каскадирования реализован в графе, фронтенд вызывает один или несколько endpoint’ов: запуск сценария, передача файлов/целей/чеклистов, получение структурированного результата (цели по подразделениям) для дашборда.
- **Формат вложений:** уточнить с бэкендом: base64, multipart, или предзагрузка с передачей id файлов в теле запроса.

---

Этот план можно использовать как ТЗ для пошаговой реализации фронтенда. При необходимости следующий шаг — создать структуру React-проекта (Vite + роуты + заглушки страниц) по этому плану.
